<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Geeps - Relatórios</title>

    <!-- Bootstrap Core CSS -->
    <link href="/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="/css/sb-admin-2.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script type="text/javascript">
      google.load('visualization', '1.0', {'packages':['corechart']});

      // Set a callback to run when the Google Visualization API is loaded.
      google.setOnLoadCallback(drawChart);

      google.load("visualization", "1.1", {packages:["calendar"]});

      // Callback that creates and populates a data table,
      // instantiates the pie chart, passes in the data and
      // draws it.
      function drawChart() {

        // Create the data table.
        var data = new google.visualization.DataTable();
        data.addColumn('string', 'Topping');
        data.addColumn('number', 'Slices');

        // Trabalhando com os dados do mongo.
        var mapBairros = new Map();
        var mapDatas = new Map();

        {{#each pedidos}}
            // ---------------------------
            // Gráfico utilizando bairro - cidade
            // ---------------------------
            if(mapBairros.get('{{this.endereco_entrega.bairro}}' + ' - ' + '{{this.endereco_entrega.cidade}}')){
                var cont = mapBairros.get('{{this.endereco_entrega.bairro}}' + ' - ' + '{{this.endereco_entrega.cidade}}');
                mapBairros.delete('{{this.endereco_entrega.bairro}}');
                mapBairros.set('{{this.endereco_entrega.bairro}}' + ' - ' + '{{this.endereco_entrega.cidade}}', cont + 1);
            } else{
                mapBairros.set(('{{this.endereco_entrega.bairro}}' + ' - ' + '{{this.endereco_entrega.cidade}}'), 1);
            }

            // ---------------------------
            // Gráfico utilizando data de criação do pedido
            // ---------------------------
            var tempDate = (new Date('{{this.data_criacao}}'.toString().substring(0,15))).toString();            
            if (mapDatas.get(tempDate)){
                var cont = mapDatas.get(tempDate);
                mapDatas.delete(tempDate);
                mapDatas.set(tempDate, cont + 1);
            } else {
                mapDatas.set(tempDate, 1);
            }
        {{/each}}

        // -----------------------------------------------
        // Criando dados para colocar no gráfico de pizza
        // -----------------------------------------------
        var dados = [];
        mapBairros.forEach(function (value, key, mapObj) {
            dados.push([key, value]);
        });

        data.addRows(dados);

        // Set chart options
        var options = {'title':'Quais bairros mais vendem'};

        // Instantiate and draw our chart, passing in some options.
        var chart = new google.visualization.PieChart(document.getElementById('chart_div'));
        chart.draw(data, options);
        
        // -----------------------------------------------
        // Criando dados para colocar no gráfico das datas
        // -----------------------------------------------
        var datasDosPedidos = new Array();
        mapDatas.forEach(function (value, key, mapObj) {
            datasDosPedidos.push([new Date(key.toString().substring(0, 15)), value]);
        });     

        var dataTable = new google.visualization.DataTable();
        dataTable.addColumn({ type: 'date', id: 'Date' });
        dataTable.addColumn({ type: 'number', id: 'Won/Loss' });
        dataTable.addRows(datasDosPedidos);

       var chart = new google.visualization.Calendar(document.getElementById('calendar_basic'));

       var options = {
         title: "Vendas"
       };

       chart.draw(dataTable, options);
      }
    </script>

</head>

<body>

<div id="wrapper">

    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-static-top" role="navigation" style="margin-bottom: 0">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Geeps</a>
        </div>
        <!-- /.navbar-header -->

        <ul class="nav navbar-top-links navbar-right">

            <!-- /.dropdown -->
            <li class="dropdown">
                <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                    <i class="fa fa-user fa-fw"></i> <i class="fa fa-caret-down"></i>
                </a>
                <ul class="dropdown-menu dropdown-user">
                    <li><a href="/empresa/perfil"><i class="fa fa-user fa-fw"></i> Perfil</a>
                    </li>
                    <li><a href="#"><i class="fa fa-gear fa-fw"></i> Configurações</a>
                    </li>
                    <li><a href="/empresa/pagamento"><i class="fa fa-money fa-fw"></i> Pagamento</a>
                    </li>
                    <li class="divider"></li>
                    <li><a href="/auth/login"><i class="fa fa-sign-out fa-fw"></i> Logout</a>
                    </li>
                </ul>
                <!-- /.dropdown-user -->
            </li>
            <!-- /.dropdown -->
        </ul>
        <!-- /.navbar-top-links -->

        <div class="navbar-default sidebar" role="navigation">
            <div class="sidebar-nav navbar-collapse">
                <ul class="nav" id="side-menu">
                    <li>
                        <a href="/"><i class="fa fa-home fa-fw"></i> Início</a>
                    </li>
                    <li>
                        <a href="#"><i class="fa fa-shopping-cart fa-fw"></i> Pedidos
                            <span class="fa arrow"></span></a>
                        <ul class="nav nav-second-level">
                            <li>
                                <a href="/empresa/pedido">Cadastrar Pedido</a>
                            </li>
                            <li>
                                <a href="/empresa/pedidos">Pedidos Em Andamento</a>
                            </li>
                            <li>
                                <a href="/empresa/pedidos_encerrados">Pedidos Encerrados</a>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <a href="/empresa/relatorios"><i class="fa fa-bar-chart-o fa-fw"></i> Relatórios
                        </a>
                    </li>
                    <li>
                        <a href="#"><i class="fa fa-truck fa-fw"></i> Entregadores
                            <span class="fa arrow"></span></a>
                        <ul class="nav nav-second-level">
                            <li>
                                <a href="/empresa/entregador">Cadastrar Entregador</a>
                            </li>
                            <li>
                                <a href="/empresa/entregadores">Visualizar</a>
                            </li>

                        </ul>
                    </li>
                </ul>
            </div>
            <!-- /.sidebar-collapse -->
        </div>
        <!-- /.navbar-static-side -->
    </nav>

    <div id="page-wrapper">
        <div class="row">
            <div class="col-lg-12">
                <h1 class="page-header">Pedidos Cadastrados</h1>
            </div>
            Numero de pedidos: {{pedidos.length}}

            <div class="table-responsive">
                <div id="chart_div" style="width: 100%; height: auto;"></div>
                <div id="calendar_basic" style="width: 1000px; height: 350px;"></div>
            </div>
            <!-- /.col-lg-12 -->
        </div>

    </div>
    <!-- /#page-wrapper -->

</div>
<!-- /#wrapper -->

<!-- jQuery -->
<script src="/js/jquery-1.11.1.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js"></script>

<!-- Metis Menu Plugin JavaScript -->
<script src="/js/metisMenu.min.js"></script>

<!-- Custom Theme JavaScript -->
<script src="/js/sb-admin-2.js"></script>

</body>

</html>